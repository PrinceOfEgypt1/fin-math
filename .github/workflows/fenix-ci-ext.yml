name: Fenix CI (ext)
on:
  workflow_dispatch:
  pull_request:
    branches: [ main, develop ]
  push:
    branches: [ main, develop ]
jobs:
  fenix:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '22'

      - name: Fênix — OpenAPI check
        run: node .fenix/checks/validators/openapi_check.cjs

      - name: Fênix — dry-run (plan)
        run: .fenix/scripts/fenix-dry-run.sh --scope changed --plan .fenix/artifacts/plan.ci.md

      - name: Fênix — KPIs
        run: .fenix/scripts/fenix-report.sh --from ci --kpis --out .fenix/artifacts/kpis.ci.json

      - name: Publicar artefatos do Fênix
        uses: actions/upload-artifact@v4
        with:
          name: fenix-artifacts
          path: .fenix/artifacts/
