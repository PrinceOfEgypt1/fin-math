name: Fenix CI (ext)

on:
  pull_request:
    branches: [ main, develop ]
  workflow_dispatch:

jobs:
  fenix:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Node (para validadores .cjs)
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: OpenAPI check (best effort)
        run: |
          node .fenix/checks/validators/openapi_check.cjs || echo "openapi_check opcional no bootstrap"

      - name: KPIs (best effort)
        run: |
          chmod +x .fenix/scripts/fenix-report.sh || true
          ./.fenix/scripts/fenix-report.sh --from ci --kpis --out .fenix/artifacts/kpis.ci.json || true
          echo "Conte√∫do KPIs:"
          test -f .fenix/artifacts/kpis.ci.json && cat .fenix/artifacts/kpis.ci.json || true

      - name: Always green
        run: echo "Bootstrap OK - CI Verde"
